<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Smart Route Optimizer</title>

<script src="https://unpkg.com/tesseract.js@v4.0.1/dist/tesseract.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=Ğ¢Ğ’ĞĞ™_API_KEY&libraries=geometry"></script>

<style>
body { font-family:-apple-system,sans-serif; background:#f2f2f7; margin:0; padding:15px }
.card { background:#fff; border-radius:14px; padding:15px; margin-bottom:15px }
textarea { width:100%; height:120px; padding:10px; border-radius:10px; border:1px solid #ccc }
button { width:100%; padding:14px; border:none; border-radius:10px; font-weight:bold; cursor:pointer }
.blue { background:#007AFF; color:#fff; margin-bottom:10px }
.green { background:#34C759; color:#fff }
#status { text-align:center; font-weight:bold; margin-bottom:10px }
.route-item { background:#fafafa; border-left:5px solid #007AFF; padding:10px; margin-bottom:8px; border-radius:6px }
</style>
</head>

<body>

<div class="card">
<div id="status">ğŸ“ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</div>
<textarea id="textInput" placeholder="Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ°Ğ´Ñ€ĞµÑĞ° Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñƒ"></textarea>
<button class="blue" onclick="camera.click()">ğŸ“· Ğ¤Ğ¾Ñ‚Ğ¾</button>
<button class="green" onclick="start()">ğŸš€ ĞŸĞ¾ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</button>
<input type="file" id="camera" hidden accept="image/*" capture="environment" onchange="runOCR(this.files)">
</div>

<div class="card" id="segments"></div>
<div class="card"><h3>ğŸ“‹ ĞÑ‡ĞµÑ€ĞµĞ´Ğ½Ğ¾ÑÑ‚ÑŒ:</h3><div id="list"></div></div>

<script>
const statusEl = document.getElementById('status');
let userLocation = null;
let points = [];

/* ================= OCR ================= */

async function runOCR(files) {
    if (!files.length) return;
    statusEl.innerText = "ğŸ” Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ Ñ‚ĞµĞºÑÑ‚...";
    const worker = await Tesseract.createWorker('deu+rus');
    const { data:{ text } } = await worker.recognize(files[0]);
    document.getElementById('textInput').value += "\n" + text;
    await worker.terminate();
    statusEl.innerText = "âœ… Ğ¢ĞµĞºÑÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½";
}

/* ================= START ================= */

function start() {
    statusEl.innerText = "ğŸ“¡ ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ GPS...";
    navigator.geolocation.getCurrentPosition(
        pos => {
            userLocation = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
            process();
        },
        () => process(),
        { timeout: 7000 }
    );
}

/* ================= ADDRESS PROCESSING ================= */

async function process() {
    const lines = document.getElementById('textInput').value
        .split('\n')
        .map(l => l.trim())
